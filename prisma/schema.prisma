generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                     String                        @id @default(uuid())
  email                  String                        @unique
  passwordHash           String                        @map("password_hash")
  role                   UserRole
  status                 UserStatus                    @default(active)
  createdAt              DateTime                      @default(now()) @map("created_at")
  updatedAt              DateTime                      @updatedAt @map("updated_at")
  displayName            String?                       @map("display_name")
  doctorProfile          DoctorProfile?
  patient                Patient?
  uploadedFiles          FileObject[]
  chatThreadsAsDoctor    ChatThread[]                  @relation("ChatThreadDoctor")
  chatThreadsAsPatient   ChatThread[]                  @relation("ChatThreadPatient")
  chatMessages           ChatMessage[]                 @relation("ChatMessageSender")
  paymentsAsDoctor       Payment[]                     @relation("PaymentDoctor")
  paymentsAsPatient      Payment[]                     @relation("PaymentPatient")
  sessions               Session[]

  @@map("users")
}

model Session {
  id               String        @id @default(uuid())
  userId           String        @map("user_id")
  refreshTokenHash String        @map("refresh_token_hash")
  status           SessionStatus @default(active)
  createdAt        DateTime      @default(now()) @map("created_at")
  lastUsedAt       DateTime?     @map("last_used_at")
  revokedAt        DateTime?     @map("revoked_at")
  ip               String?
  userAgent        String?       @map("user_agent")
  expiresAt        DateTime      @map("expires_at")
  user             User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("sessions")
}

model Patient {
  id              String              @id @default(uuid()) @map("id")
  userId          String              @unique @map("user_id")
  legalFirstName  String              @map("legal_first_name")
  legalLastName   String              @map("legal_last_name")
  documentType    PatientDocumentType @map("document_type")
  documentNumber  String              @map("document_number")
  documentCountry String              @default("AR") @map("document_country")
  birthDate       DateTime            @map("birth_date") @db.Date
  phone           String?             @map("phone")
  addressText     String?             @map("address_text")
  emergencyContactName  String?       @map("emergency_contact_name")
  emergencyContactPhone String?       @map("emergency_contact_phone")
  insuranceName         String?       @map("insurance_name")
  createdAt       DateTime            @default(now()) @map("created_at")
  updatedAt       DateTime            @updatedAt @map("updated_at")
  appointments    Appointment[]
  user            User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  files           PatientFile[]

  @@unique([documentType, documentCountry, documentNumber])
  @@map("patients")
}

model PatientClinicalAllergy {
  id                 String                     @id @default(uuid())
  patientUserId      String                     @map("patient_user_id")
  name               String
  notes              String?                    @db.Text
  sourceType         ClinicalSourceType         @default(patient) @map("source_type")
  sourceUserId       String?                    @map("source_user_id")
  verificationStatus ClinicalVerificationStatus @default(unverified) @map("verification_status")
  verifiedByUserId   String?                    @map("verified_by_user_id")
  verifiedAt         DateTime?                  @map("verified_at")
  isActive           Boolean                    @default(true) @map("is_active")
  endedAt            DateTime?                  @map("ended_at")
  deletedAt          DateTime?                  @map("deleted_at")
  createdAt          DateTime                   @default(now()) @map("created_at")
  updatedAt          DateTime                   @updatedAt @map("updated_at")

  @@index([patientUserId, isActive])
  @@index([patientUserId, verificationStatus])
  @@map("patient_clinical_allergies")
}

model PatientClinicalMedication {
  id                 String                     @id @default(uuid())
  patientUserId      String                     @map("patient_user_id")
  name               String
  notes              String?                    @db.Text
  sourceType         ClinicalSourceType         @default(patient) @map("source_type")
  sourceUserId       String?                    @map("source_user_id")
  verificationStatus ClinicalVerificationStatus @default(unverified) @map("verification_status")
  verifiedByUserId   String?                    @map("verified_by_user_id")
  verifiedAt         DateTime?                  @map("verified_at")
  isActive           Boolean                    @default(true) @map("is_active")
  endedAt            DateTime?                  @map("ended_at")
  deletedAt          DateTime?                  @map("deleted_at")
  createdAt          DateTime                   @default(now()) @map("created_at")
  updatedAt          DateTime                   @updatedAt @map("updated_at")

  @@index([patientUserId, isActive])
  @@index([patientUserId, verificationStatus])
  @@map("patient_clinical_medications")
}

model PatientClinicalCondition {
  id                 String                     @id @default(uuid())
  patientUserId      String                     @map("patient_user_id")
  name               String
  notes              String?                    @db.Text
  sourceType         ClinicalSourceType         @default(patient) @map("source_type")
  sourceUserId       String?                    @map("source_user_id")
  verificationStatus ClinicalVerificationStatus @default(unverified) @map("verification_status")
  verifiedByUserId   String?                    @map("verified_by_user_id")
  verifiedAt         DateTime?                  @map("verified_at")
  isActive           Boolean                    @default(true) @map("is_active")
  endedAt            DateTime?                  @map("ended_at")
  deletedAt          DateTime?                  @map("deleted_at")
  createdAt          DateTime                   @default(now()) @map("created_at")
  updatedAt          DateTime                   @updatedAt @map("updated_at")

  @@index([patientUserId, isActive])
  @@index([patientUserId, verificationStatus])
  @@map("patient_clinical_conditions")
}

model PatientClinicalProcedure {
  id                 String                     @id @default(uuid())
  patientUserId      String                     @map("patient_user_id")
  name               String
  notes              String?                    @db.Text
  sourceType         ClinicalSourceType         @default(patient) @map("source_type")
  sourceUserId       String?                    @map("source_user_id")
  verificationStatus ClinicalVerificationStatus @default(unverified) @map("verification_status")
  verifiedByUserId   String?                    @map("verified_by_user_id")
  verifiedAt         DateTime?                  @map("verified_at")
  isActive           Boolean                    @default(true) @map("is_active")
  endedAt            DateTime?                  @map("ended_at")
  deletedAt          DateTime?                  @map("deleted_at")
  createdAt          DateTime                   @default(now()) @map("created_at")
  updatedAt          DateTime                   @updatedAt @map("updated_at")

  @@index([patientUserId, isActive])
  @@index([patientUserId, verificationStatus])
  @@map("patient_clinical_procedures")
}

model DoctorProfile {
  userId             String                    @id @map("user_id")
  bio                String?
  currency           String                    @default("ARS")
  isActive           Boolean                   @default(true) @map("is_active")
  verificationStatus DoctorVerificationStatus  @default(unverified) @map("verification_status")
  createdAt          DateTime                  @default(now()) @map("created_at")
  updatedAt          DateTime                  @updatedAt @map("updated_at")
  location           Unsupported("geography")? @map("location")
  city               String?                   @map("city")
  region             String?                   @map("region")
  countryCode        String?                   @map("country_code")
  priceCents         Int                       @map("price_cents")
  firstName          String?                   @map("first_name")
  lastName           String?                   @map("last_name")
  appointments       Appointment[]
  user               User                      @relation(fields: [userId], references: [id], onDelete: Cascade)
  specialties        DoctorSpecialty[]
  availabilityRules  DoctorAvailabilityRule[]
  availabilityExceptions DoctorAvailabilityException[]
  schedulingConfig   DoctorSchedulingConfig?
  doctorPaymentAccount DoctorPaymentAccount?

  @@map("doctor_profiles")
}

model Specialty {
  id       String            @id @default(uuid())
  name     String            @unique
  isActive Boolean           @default(true) @map("is_active")
  doctors  DoctorSpecialty[]

  @@map("specialties")
}

model DoctorSpecialty {
  doctorUserId String        @map("doctor_user_id")
  specialtyId  String        @map("specialty_id")
  doctor       DoctorProfile @relation(fields: [doctorUserId], references: [userId], onDelete: Cascade)
  specialty    Specialty     @relation(fields: [specialtyId], references: [id], onDelete: Cascade)

  @@id([doctorUserId, specialtyId])
  @@index([specialtyId])
  @@map("doctor_specialties")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model spatial_ref_sys {
  srid      Int     @id
  auth_name String? @db.VarChar(256)
  auth_srid Int?
  srtext    String? @db.VarChar(2048)
  proj4text String? @db.VarChar(2048)
}

model DoctorAvailabilityRule {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  dayOfWeek Int      @map("day_of_week")
  startTime String   @map("start_time")
  endTime   String   @map("end_time")
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  doctorProfile DoctorProfile @relation(fields: [userId], references: [userId], onDelete: Cascade)

  @@index([userId])
  @@map("doctor_availability_rules")
}

model DoctorAvailabilityException {
  id            String                          @id @default(uuid())
  userId        String                          @map("user_id")
  date          DateTime                        @map("date") @db.Date
  type          DoctorAvailabilityExceptionType
  customWindows Json?                           @map("custom_windows")
  createdAt     DateTime                        @default(now()) @map("created_at")
  updatedAt     DateTime                        @updatedAt @map("updated_at")
  doctorProfile DoctorProfile                   @relation(fields: [userId], references: [userId], onDelete: Cascade)

  @@index([userId, date])
  @@map("doctor_availability_exceptions")
}

model DoctorSchedulingConfig {
  userId              String   @id @map("user_id")
  slotDurationMinutes Int      @default(60) @map("slot_duration_minutes")
  leadTimeHours       Int      @default(24) @map("lead_time_hours")
  horizonDays         Int      @default(60) @map("horizon_days")
  timezone            String   @default("America/Argentina/Buenos_Aires")
  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")
  doctorProfile       DoctorProfile @relation(fields: [userId], references: [userId], onDelete: Cascade)

  @@map("doctor_scheduling_configs")
}

model Appointment {
  id                 String                 @id @default(uuid())
  doctorUserId       String                 @map("doctor_user_id")
  patientId          String                 @map("patient_id")
  startAt            DateTime               @map("start_at")
  endAt              DateTime               @map("end_at")
  reason             String?                @map("reason")
  status             AppointmentStatus      @default(pending_payment)
  createdAt          DateTime               @default(now()) @map("created_at")
  cancelledAt        DateTime?              @map("cancelled_at")
  cancellationReason String?                @map("cancellation_reason")
  paymentExpiresAt   DateTime?              @map("payment_expires_at")
  doctor             DoctorProfile          @relation(fields: [doctorUserId], references: [userId], onDelete: Cascade)
  patient            Patient                @relation(fields: [patientId], references: [id], onDelete: Cascade)
  queueItems         ConsultationQueueItem?
  consultation       Consultation?
  payment            Payment?               @relation("AppointmentPayment")

  @@index([doctorUserId, startAt])
  @@index([patientId, startAt])
  @@map("appointments")
}

model Consultation {
  id             String                 @id @default(uuid())
  appointmentId  String?                @unique @map("appointment_id")
  queueItemId    String?                @unique @map("queue_item_id")
  doctorUserId   String                 @map("doctor_user_id")
  patientUserId  String                 @map("patient_user_id")
  status         ConsultationStatus     @default(draft)
  startedAt      DateTime?              @map("started_at")
  closedAt       DateTime?              @map("closed_at")
  videoProvider  String?                @map("video_provider")
  videoRoomName  String?                @map("video_room_name")
  videoCreatedAt DateTime?              @map("video_created_at")
  lastActivityAt DateTime?              @map("last_activity_at")
  createdAt      DateTime               @default(now()) @map("created_at")
  updatedAt      DateTime               @updatedAt @map("updated_at")

  appointment    Appointment?           @relation(fields: [appointmentId], references: [id], onDelete: SetNull)
  queueItem      ConsultationQueueItem? @relation(fields: [queueItemId], references: [id], onDelete: SetNull)
  chatMessages   ChatMessage[]          @relation("ChatMessageConsultation")
  relatedFiles   PatientFile[]          @relation("PatientFileConsultation")
  clinicalEpisode ClinicalEpisode?

  @@index([doctorUserId, createdAt])
  @@index([patientUserId, createdAt])
  @@map("consultations")
}

model ClinicalEpisode {
  id             String      @id @default(uuid())
  consultationId String      @unique @map("consultation_id")
  patientUserId  String      @map("patient_user_id")
  doctorUserId   String      @map("doctor_user_id")
  deletedAt      DateTime?   @map("deleted_at")
  createdAt      DateTime    @default(now()) @map("created_at")
  updatedAt      DateTime    @updatedAt @map("updated_at")

  consultation Consultation @relation(fields: [consultationId], references: [id], onDelete: Cascade)
  notes        ClinicalEpisodeNote[]

  @@index([doctorUserId, createdAt])
  @@index([patientUserId, createdAt])
  @@map("clinical_episodes")
}

model ClinicalEpisodeNote {
  id              String                 @id @default(uuid())
  episodeId       String                 @map("episode_id")
  kind            ClinicalEpisodeNoteKind
  title           String
  body            String                 @db.Text
  formattedBody   String?                @db.Text @map("formatted_body")
  formattedAt     DateTime?              @map("formatted_at")
  formattedByUserId String?              @map("formatted_by_user_id")
  formatVersion   Int?                   @map("format_version")
  aiMeta          Json?                  @map("ai_meta")
  createdByUserId String                 @map("created_by_user_id")
  createdByRole   UserRole               @map("created_by_role")
  deletedAt       DateTime?              @map("deleted_at")
  createdAt       DateTime               @default(now()) @map("created_at")
  updatedAt       DateTime               @updatedAt @map("updated_at")

  episode ClinicalEpisode @relation(fields: [episodeId], references: [id], onDelete: Cascade)

  @@index([episodeId, kind])
  @@index([createdByUserId, createdAt])
  @@map("clinical_episode_notes")
}

model FileObject {
  id               String                  @id @default(uuid())
  bucket           String
  objectKey        String                  @map("object_key")
  mimeType         String                  @map("mime_type")
  sizeBytes        Int                     @map("size_bytes")
  sha256           String?                 @map("sha256")
  uploadedByUserId String                  @map("uploaded_by_user_id")
  createdAt        DateTime                @default(now()) @map("created_at")
  uploadedBy       User                    @relation(fields: [uploadedByUserId], references: [id], onDelete: Cascade)
  patientFiles     PatientFile[]

  @@index([uploadedByUserId, createdAt(sort: Desc)])
  @@map("file_objects")
}

model Payment {
  id                   String                 @id @default(uuid())
  provider             PaymentProvider
  kind                 PaymentKind
  status               PaymentStatus          @default(pending)
  amountCents          Int                    @map("amount_cents")
  currency             String                 @default("ARS")
  doctorUserId         String                 @map("doctor_user_id")
  patientUserId        String                 @map("patient_user_id")
  appointmentId        String?                @unique @map("appointment_id")
  queueItemId          String?                @unique @map("queue_item_id")
  checkoutUrl          String                 @map("checkout_url")
  providerPreferenceId String                 @unique @map("provider_preference_id")
  providerPaymentId    String?                @unique @map("provider_payment_id")
  idempotencyKey       String?                @map("idempotency_key")
  expiresAt            DateTime               @map("expires_at")
  createdAt            DateTime               @default(now()) @map("created_at")
  updatedAt            DateTime               @updatedAt @map("updated_at")
  appointment          Appointment?           @relation("AppointmentPayment", fields: [appointmentId], references: [id], onDelete: Cascade)
  doctor               User                   @relation("PaymentDoctor", fields: [doctorUserId], references: [id], onDelete: Cascade)
  patient              User                   @relation("PaymentPatient", fields: [patientUserId], references: [id], onDelete: Cascade)
  queueItem            ConsultationQueueItem? @relation("QueueItemPayment", fields: [queueItemId], references: [id], onDelete: Cascade)

  @@unique([patientUserId, idempotencyKey, kind])
  @@index([doctorUserId, status])
  @@index([patientUserId, status])
  @@map("payments")
}

model DoctorPaymentAccount {
  doctorUserId          String          @id @map("doctor_user_id")
  provider              PaymentProvider
  mpUserId              String?         @map("mp_user_id")
  collectorId           String?         @map("collector_id")
  accessTokenEncrypted  String          @map("access_token_encrypted")
  refreshTokenEncrypted String          @map("refresh_token_encrypted")
  tokenExpiresAt        DateTime        @map("token_expires_at")
  createdAt             DateTime        @default(now()) @map("created_at")
  updatedAt             DateTime        @updatedAt @map("updated_at")
  doctorProfile         DoctorProfile   @relation(fields: [doctorUserId], references: [userId], onDelete: Cascade)

  @@map("doctor_payment_accounts")
}

model ConsultationQueueItem {
  id               String                         @id @default(uuid())
  status           ConsultationQueueStatus        @default(queued)
  entryType        ConsultationQueueEntryType     @default(emergency) @map("entry_type")
  doctorUserId     String                         @map("doctor_user_id")
  patientUserId    String                         @map("patient_user_id")
  appointmentId    String?                        @unique @map("appointment_id")
  queuedAt         DateTime                       @default(now()) @map("queued_at")
  acceptedAt       DateTime?                      @map("accepted_at")
  cancelledAt      DateTime?                      @map("cancelled_at")
  rejectedAt       DateTime?                      @map("rejected_at")
  closedAt         DateTime?                      @map("closed_at")
  expiresAt        DateTime?                      @map("expires_at")
  createdBy        String                         @map("created_by")
  acceptedBy       String?                        @map("accepted_by")
  cancelledBy      String?                        @map("cancelled_by")
  reason           String?
  createdAt        DateTime                       @default(now()) @map("created_at")
  updatedAt        DateTime                       @updatedAt @map("updated_at")
  rejectedBy       String?                        @map("rejected_by")
  paymentStatus    ConsultationQueuePaymentStatus @default(not_started) @map("payment_status")
  paymentExpiresAt DateTime?                      @map("payment_expires_at")
  appointment      Appointment?                   @relation(fields: [appointmentId], references: [id], onDelete: Cascade)
  payment          Payment?                       @relation("QueueItemPayment")
  consultation     Consultation?

  @@index([doctorUserId, status])
  @@index([patientUserId, status])
  @@map("consultation_queue_items")
}

model AuditLog {
  id           String      @id @default(uuid())
  action       AuditAction
  resourceType String      @map("resource_type")
  resourceId   String      @map("resource_id")
  actorId      String?     @map("actor_id")
  actorRole    UserRole?   @map("actor_role")
  traceId      String?     @map("trace_id")
  ip           String?     @map("ip")
  userAgent    String?     @map("user_agent")
  metadata     Json?
  createdAt    DateTime    @default(now()) @map("created_at")

  @@index([resourceType, resourceId])
  @@map("audit_logs")
}

model WebhookEvent {
  id          String          @id @default(uuid())
  provider    WebhookProvider
  eventId     String          @unique @map("event_id")
  receivedAt  DateTime        @default(now()) @map("received_at")
  processedAt DateTime?       @map("processed_at")
  status      String
  payload     Json
  traceId     String?         @map("trace_id")

  @@index([provider, receivedAt])
  @@map("webhook_events")
}

enum UserRole {
  patient
  doctor
  admin
}

enum UserStatus {
  active
  disabled
}

enum SessionStatus {
  active
  revoked
  rotated
}

enum DoctorVerificationStatus {
  unverified
  pending
  verified
  rejected
}

enum DoctorAvailabilityExceptionType {
  closed
  custom
}

enum ClinicalSourceType {
  patient
  clinician
  system
}

enum ClinicalVerificationStatus {
  unverified
  verified
  disputed
}

enum ClinicalEpisodeNoteKind {
  draft
  final
  addendum
}

enum AppointmentStatus {
  scheduled
  cancelled
  completed
  pending_payment
  confirmed
}

enum PaymentProvider {
  mercadopago
}

enum PaymentKind {
  appointment
  emergency
}

enum PaymentStatus {
  pending
  paid
  failed
  expired
  refunded
}

enum PatientDocumentType {
  DNI
  PASSPORT
  OTHER
}

enum ConsultationQueuePaymentStatus {
  not_started
  not_required
  pending
  paid
  failed
  expired
}

enum ChatMessageKind {
  text
  system
}

enum ChatParticipantRole {
  doctor
  patient
}

enum ConsultationQueueEntryType {
  appointment
  emergency
}

enum ConsultationStatus {
  draft
  in_progress
  closed
}

enum ConsultationQueueStatus {
  queued
  accepted
  cancelled
  rejected
  expired
}

enum AuditAction {
  READ
  WRITE
  VERIFY
  EXPORT
  WEBHOOK
}

enum WebhookProvider {
  mercadopago
}

model ChatThread {
  id            String        @id @default(uuid())
  doctorUserId  String        @map("doctor_user_id")
  patientUserId String        @map("patient_user_id")
  lastMessageAt DateTime?     @map("last_message_at")
  createdAt     DateTime      @default(now()) @map("created_at")
  updatedAt     DateTime      @updatedAt @map("updated_at")
  doctor        User          @relation("ChatThreadDoctor", fields: [doctorUserId], references: [id], onDelete: Cascade)
  patient       User          @relation("ChatThreadPatient", fields: [patientUserId], references: [id], onDelete: Cascade)
  messages      ChatMessage[]
  policy        ChatPolicy?

  @@unique([doctorUserId, patientUserId])
  @@index([patientUserId, lastMessageAt])
  @@index([doctorUserId, lastMessageAt])
  @@map("chat_threads")
}

model ChatPolicy {
  threadId                      String   @id @map("thread_id")
  patientCanMessage              Boolean  @default(true) @map("patient_can_message")
  allowedSchedule                Json?    @map("allowed_schedule")
  dailyLimit                    Int      @default(10) @map("daily_limit")
  burstLimit                    Int      @default(3) @map("burst_limit")
  burstWindowSeconds            Int      @default(30) @map("burst_window_seconds")
  requireRecentConsultation      Boolean  @default(true) @map("require_recent_consultation")
  recentConsultationWindowHours Int      @default(72) @map("recent_consultation_window_hours")
  closedByDoctor                 Boolean  @default(false) @map("closed_by_doctor")
  createdAt                     DateTime @default(now()) @map("created_at")
  updatedAt                     DateTime @updatedAt @map("updated_at")
  thread                        ChatThread @relation(fields: [threadId], references: [id], onDelete: Cascade)

  @@map("chat_policies")
}

model ChatMessage {
  id                    String              @id @default(uuid())
  threadId              String              @map("thread_id")
  senderUserId          String              @map("sender_user_id")
  senderRole            ChatParticipantRole @map("sender_role")
  kind                  ChatMessageKind
  text                  String?             @db.Text
  clientMessageId       String?             @map("client_message_id")
  contextConsultationId String?            @map("context_consultation_id")
  deliveredAt           DateTime?           @map("delivered_at")
  createdAt             DateTime             @default(now()) @map("created_at")
  updatedAt             DateTime             @updatedAt @map("updated_at")
  thread                ChatThread          @relation(fields: [threadId], references: [id], onDelete: Cascade)
  sender                 User                @relation("ChatMessageSender", fields: [senderUserId], references: [id], onDelete: Cascade)
  contextConsultation   Consultation?       @relation("ChatMessageConsultation", fields: [contextConsultationId], references: [id], onDelete: SetNull)

  @@unique([threadId, senderUserId, clientMessageId])
  @@index([threadId, createdAt(sort: Desc)])
  @@index([threadId, deliveredAt])
  @@map("chat_messages")
}

enum PatientFileStatus {
  pending_upload
  ready
  failed
  deleted
}

enum PatientFileCategory {
  lab
  image
  prescription
  other
}

model PatientFile {
  id                    String               @id @default(uuid())
  patientId             String               @map("patient_id")
  fileObjectId          String               @unique @map("file_object_id")
  status                PatientFileStatus    @default(pending_upload)
  originalName          String               @map("original_name")
  mimeType              String               @map("mime_type")
  sizeBytes             Int                  @map("size_bytes")
  sha256                String?              @map("sha256")
  category              PatientFileCategory  @default(other)
  notes                 String?              @db.Text
  uploadedByUserId      String               @map("uploaded_by_user_id")
  uploadedByRole        UserRole             @map("uploaded_by_role")
  relatedConsultationId String?              @map("related_consultation_id")
  createdAt             DateTime             @default(now()) @map("created_at")
  updatedAt             DateTime             @updatedAt @map("updated_at")
  patient               Patient              @relation(fields: [patientId], references: [id], onDelete: Cascade)
  fileObject            FileObject           @relation(fields: [fileObjectId], references: [id], onDelete: Cascade)
  relatedConsultation   Consultation?        @relation("PatientFileConsultation", fields: [relatedConsultationId], references: [id], onDelete: SetNull)

  @@index([patientId, createdAt(sort: Desc)])
  @@index([patientId, category, createdAt(sort: Desc)])
  @@index([relatedConsultationId])
  @@map("patient_files")
}
